root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net# git pull origin main
From https://github.com/alfred7615/apo360
 * branch            main       -> FETCH_HEAD
hint: You have divergent branches and need to specify how to reconcile them.
hint: You can do so by running one of the following commands sometime before
hint: your next pull:
hint:
hint:   git config pull.rebase false  # merge
hint:   git config pull.rebase true   # rebase
hint:   git config pull.ff only       # fast-forward only
hint:
hint: You can replace "git config" with "git config --global" to set a default
hint: preference for all repositories. You can also pass --rebase, --no-rebase,
hint: or --ff-only on the command line to override the configured default per
hint: invocation.
fatal: Need to specify how to reconcile divergent branches.
root@srv1170282:/var/www/apo360.net# npm install

up to date, audited 523 packages in 3s

69 packages are looking for funding
  run `npm fund` for details

9 vulnerabilities (3 low, 5 moderate, 1 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
root@srv1170282:/var/www/apo360.net# npm run build

> rest-express@1.0.0 build
> vite build && esbuild server/index-prod.ts --platform=node --packages=external --bundle --format=esm --outfile=dist/index.js

vite v5.4.20 building for production...
transforming (4) src/App.tsx
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
âœ“ 2792 modules transformed.
../dist/public/index.html                     1.53 kB â”‚ gzip:   0.66 kB
../dist/public/assets/index-BnNusofl.css    147.72 kB â”‚ gzip:  27.36 kB
../dist/public/assets/index-8rziSsO1.js   1,497.09 kB â”‚ gzip: 374.43 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 22.36s
â–² [WARNING] Duplicate member "updateServicio" in class body [duplicate-class-member]

    server/storage.ts:1885:8:
      1885 â”‚   async updateServicio(id: string, data: any): Promise<any> {
           â•µ         ~~~~~~~~~~~~~~

  The original member "updateServicio" is here:

    server/storage.ts:827:8:
      827 â”‚   async updateServicio(id: string, data: Partial<InsertServicio>): Promise<Servicio | undefined> {
          â•µ         ~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getFavoritosUsuario" in class body [duplicate-class-member]

    server/storage.ts:2450:8:
      2450 â”‚   async getFavoritosUsuario(usuarioId: string, tipo?: string): Promise<any[]> {
           â•µ         ~~~~~~~~~~~~~~~~~~~

  The original member "getFavoritosUsuario" is here:

    server/storage.ts:795:8:
      795 â”‚   async getFavoritosUsuario(usuarioId: string): Promise<any[]> {
          â•µ         ~~~~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getInteraccionesUsuario" in class body [duplicate-class-member]

    server/storage.ts:2633:8:
      2633 â”‚   async getInteraccionesUsuario(
           â•µ         ~~~~~~~~~~~~~~~~~~~~~~~

  The original member "getInteraccionesUsuario" is here:

    server/storage.ts:571:8:
      571 â”‚   async getInteraccionesUsuario(publicidadId: string, usuarioId: string): Promise<{ hasLike: boolean; has...
          â•µ         ~~~~~~~~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getComentarios" in class body [duplicate-class-member]

    server/storage.ts:2657:8:
      2657 â”‚   async getComentarios(tipoContenido: string, contenidoId: string): Promise<Comentario[]> {
           â•µ         ~~~~~~~~~~~~~~

  The original member "getComentarios" is here:

    server/storage.ts:1854:8:
      1854 â”‚   async getComentarios(tipoContenido: string, contenidoId: string): Promise<Comentario[]> {
           â•µ         ~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "createComentario" in class body [duplicate-class-member]

    server/storage.ts:2673:8:
      2673 â”‚   async createComentario(data: InsertComentario): Promise<Comentario> {
           â•µ         ~~~~~~~~~~~~~~~~

  The original member "createComentario" is here:

    server/storage.ts:1867:8:
      1867 â”‚   async createComentario(data: InsertComentario): Promise<Comentario> {
           â•µ         ~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "deleteComentario" in class body [duplicate-class-member]

    server/storage.ts:2687:8:
      2687 â”‚   async deleteComentario(id: string): Promise<void> {
           â•µ         ~~~~~~~~~~~~~~~~

  The original member "deleteComentario" is here:

    server/storage.ts:1875:8:
      1875 â”‚   async deleteComentario(id: string): Promise<void> {
           â•µ         ~~~~~~~~~~~~~~~~

6 of 7 warnings shown (disable the message limit with --log-limit=0)

  dist/index.js  405.7kb

âš¡ Done in 270ms
root@srv1170282:/var/www/apo360.net# psql "postgresql://apo360_admin:Admin2025@127.0.0.1:5432/apo360_prod?sslmode=disable" -f scripts/sistema-roles.sql
psql: error: scripts/sistema-roles.sql: No such file or directory
root@srv1170282:/var/www/apo360.net# pm2 restart apo360
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [apo360](ids: [ 0 ])
[PM2] [apo360](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ apo360             â”‚ cluster  â”‚ 16   â”‚ online    â”‚ 0%       â”‚ 44.4mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@srv1170282:/var/www/apo360.net# pm2 logs apo360 --lines 30
[TAILING] Tailing last 30 lines for [apo360] process (change the value with --lines option)
/var/www/apo360.net/logs/error-0.log last 30 lines:
0|apo360   |   dataType: undefined,
0|apo360   |   constraint: undefined,
0|apo360   |   file: 'parse_relation.c',
0|apo360   |   line: '1449',
0|apo360   |   routine: 'parserOpenTable'
0|apo360   | }
0|apo360   | 2025-12-12T05:44:46: Error al obtener subcategorÃ­as de rol: error: relation "subcategorias_rol" does not exist
0|apo360   |     at /var/www/apo360.net/node_modules/pg-pool/index.js:45:11
0|apo360   |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|apo360   |     at async file:///var/www/apo360.net/node_modules/drizzle-orm/node-postgres/session.js:83:22
0|apo360   |     at async DatabaseStorage.getSubcategoriasRol (file:///var/www/apo360.net/dist/index.js:3260:16)
0|apo360   |     at async file:///var/www/apo360.net/dist/index.js:5996:29 {
0|apo360   |   length: 117,
0|apo360   |   severity: 'ERROR',
0|apo360   |   code: '42P01',
0|apo360   |   detail: undefined,
0|apo360   |   hint: undefined,
0|apo360   |   position: '124',
0|apo360   |   internalPosition: undefined,
0|apo360   |   internalQuery: undefined,
0|apo360   |   where: undefined,
0|apo360   |   schema: undefined,
0|apo360   |   table: undefined,
0|apo360   |   column: undefined,
0|apo360   |   dataType: undefined,
0|apo360   |   constraint: undefined,
0|apo360   |   file: 'parse_relation.c',
0|apo360   |   line: '1449',
0|apo360   |   routine: 'parserOpenTable'
0|apo360   | }

/var/www/apo360.net/logs/output-0.log last 30 lines:
0|apo360   | 2025-12-12T16:39:01: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:39:07: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:39:13: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:39:20: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:39:29: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:39:36: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:39:46: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:39:56: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:01: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:07: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:12: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:17: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:23: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:28: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:33: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:39: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:44: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:49: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:40:53: ğŸ—„ï¸ Usando PostgreSQL local (producciÃ³n)
0|apo360   | 2025-12-12T16:40:53: ğŸ” Modo de autenticaciÃ³n solicitado: basic
0|apo360   | 2025-12-12T16:40:53: ğŸ” Configurando autenticaciÃ³n bÃ¡sica (email/contraseÃ±a)...
0|apo360   | 2025-12-12T16:40:53: âœ… AutenticaciÃ³n bÃ¡sica configurada
0|apo360   | 2025-12-12T16:40:53:    ğŸ“§ Login: POST /api/auth/login
0|apo360   | 2025-12-12T16:40:53:    ğŸ“ Registro: POST /api/auth/register
0|apo360   | 2025-12-12T16:40:53: ğŸš€ Servidor WebSocket configurado en /ws
0|apo360   | 2025-12-12T16:40:53: 4:40:53 PM [express] ğŸ”„ Verificando migraciÃ³n de miembros_grupo...
0|apo360   | 2025-12-12T16:40:53: 4:40:53 PM [express] âœ… Tabla miembros_grupo ya estÃ¡ sincronizada
0|apo360   | 2025-12-12T16:40:53: 4:40:53 PM [express] serving on port 5000
0|apo360   | 2025-12-12T16:40:55: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:41:00: âŒ WebSocket rechazado: Usuario no autenticado

0|apo360  | 2025-12-12T16:41:05: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360  | 2025-12-12T16:41:11: âŒ WebSocket rechazado: Usuario no autenticado