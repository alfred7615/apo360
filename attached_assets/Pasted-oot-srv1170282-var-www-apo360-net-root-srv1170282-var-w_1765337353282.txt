oot@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net# cd /var/www/apo360.net
root@srv1170282:/var/www/apo360.net# git pull origin main
un build
pm2 delete apo360
pm2 start ecosystem.config.cjs
pm2 logs apo360 --lines 20remote: Enumerating objects: 26, done.
remote: Counting objects: 100% (26/26), done.
remote: Compressing objects: 100% (6/6), done.
remote: Total 20 (delta 14), reused 20 (delta 14), pack-reused 0 (from 0)
Unpacking objects: 100% (20/20), 8.15 KiB | 521.00 KiB/s, done.
From https://github.com/alfred7615/apo360
 * branch            main       -> FETCH_HEAD
   5c87ad5..80a573f  main       -> origin/main
Updating 5c87ad5..80a573f
Fast-forward
 ...ot-srv1170282-var-www-apo360-net-git-stash-Saved-worki_1765336686969.txt |  96 +++++++++++++++++++++
 ...ot-srv1170282-var-www-apo360-net-npm-install-dotenv-ad_1765337000783.txt | 165 ++++++++++++++++++++++++++++++++++++
 ...oot-srv1170282-var-www-apo360-net-cd-var-www-apo360-ne_1765336566826.txt |  71 ++++++++++++++++
 ...oot-srv1170282-var-www-apo360-net-npm-install-dotenv-a_1765336844637.txt | 165 ++++++++++++++++++++++++++++++++++++
 ecosystem.config.cjs                                                        |  28 ++++--
 server/authConfig.ts                                                        |   5 +-
 server/db.ts                                                                |  20 ++---
 7 files changed, 532 insertions(+), 18 deletions(-)
 create mode 100644 attached_assets/Pasted-oot-srv1170282-var-www-apo360-net-git-stash-Saved-worki_1765336686969.txt
 create mode 100644 attached_assets/Pasted-oot-srv1170282-var-www-apo360-net-npm-install-dotenv-ad_1765337000783.txt
 create mode 100644 attached_assets/Pasted-root-srv1170282-var-www-apo360-net-cd-var-www-apo360-ne_1765336566826.txt
 create mode 100644 attached_assets/Pasted-root-srv1170282-var-www-apo360-net-npm-install-dotenv-a_1765336844637.txt
root@srv1170282:/var/www/apo360.net# npm install

up to date, audited 524 packages in 3s

70 packages are looking for funding
  run `npm fund` for details

9 vulnerabilities (3 low, 5 moderate, 1 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
root@srv1170282:/var/www/apo360.net# npm run build

> rest-express@1.0.0 build
> vite build && esbuild server/index-prod.ts --platform=node --packages=external --bundle --format=esm --outfile=dist/index.js

vite v5.4.20 building for production...
transforming (4) src/App.tsx
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
âœ“ 2790 modules transformed.
../dist/public/index.html                     1.53 kB â”‚ gzip:   0.66 kB
../dist/public/assets/index-CpuEqJzU.css    144.64 kB â”‚ gzip:  26.94 kB
../dist/public/assets/index-D0Tej4IN.js   1,436.20 kB â”‚ gzip: 362.38 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 14.88s
â–² [WARNING] Duplicate member "updateServicio" in class body [duplicate-class-member]

    server/storage.ts:1859:8:
      1859 â”‚   async updateServicio(id: string, data: any): Promise<any> {
           â•µ         ~~~~~~~~~~~~~~

  The original member "updateServicio" is here:

    server/storage.ts:808:8:
      808 â”‚   async updateServicio(id: string, data: Partial<InsertServicio>): Promise<Servicio | undefined> {
          â•µ         ~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getFavoritosUsuario" in class body [duplicate-class-member]

    server/storage.ts:2424:8:
      2424 â”‚   async getFavoritosUsuario(usuarioId: string, tipo?: string): Promise<any[]> {
           â•µ         ~~~~~~~~~~~~~~~~~~~

  The original member "getFavoritosUsuario" is here:

    server/storage.ts:776:8:
      776 â”‚   async getFavoritosUsuario(usuarioId: string): Promise<any[]> {
          â•µ         ~~~~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getInteraccionesUsuario" in class body [duplicate-class-member]

    server/storage.ts:2607:8:
      2607 â”‚   async getInteraccionesUsuario(
           â•µ         ~~~~~~~~~~~~~~~~~~~~~~~

  The original member "getInteraccionesUsuario" is here:

    server/storage.ts:552:8:
      552 â”‚   async getInteraccionesUsuario(publicidadId: string, usuarioId: string): Promise<{ hasLike: boolean; has...
          â•µ         ~~~~~~~~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getComentarios" in class body [duplicate-class-member]

    server/storage.ts:2631:8:
      2631 â”‚   async getComentarios(tipoContenido: string, contenidoId: string): Promise<Comentario[]> {
           â•µ         ~~~~~~~~~~~~~~

  The original member "getComentarios" is here:

    server/storage.ts:1828:8:
      1828 â”‚   async getComentarios(tipoContenido: string, contenidoId: string): Promise<Comentario[]> {
           â•µ         ~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "createComentario" in class body [duplicate-class-member]

    server/storage.ts:2647:8:
      2647 â”‚   async createComentario(data: InsertComentario): Promise<Comentario> {
           â•µ         ~~~~~~~~~~~~~~~~

  The original member "createComentario" is here:

    server/storage.ts:1841:8:
      1841 â”‚   async createComentario(data: InsertComentario): Promise<Comentario> {
           â•µ         ~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "deleteComentario" in class body [duplicate-class-member]

    server/storage.ts:2661:8:
      2661 â”‚   async deleteComentario(id: string): Promise<void> {
           â•µ         ~~~~~~~~~~~~~~~~

  The original member "deleteComentario" is here:

    server/storage.ts:1849:8:
      1849 â”‚   async deleteComentario(id: string): Promise<void> {
           â•µ         ~~~~~~~~~~~~~~~~

6 of 7 warnings shown (disable the message limit with --log-limit=0)

  dist/index.js  375.4kb

âš¡ Done in 47ms
root@srv1170282:/var/www/apo360.net# pm2 delete apo360
[PM2] Applying action deleteProcessId on app [apo360](ids: [ 0 ])
[PM2] [apo360](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@srv1170282:/var/www/apo360.net# pm2 start ecosystem.config.cjs
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
[PM2][WARN] Applications apo360 not running, starting...
[PM2] App [apo360] launched (1 instances)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ apo360             â”‚ cluster  â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 40.1mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@srv1170282:/var/www/apo360.net# pm2 logs apo360 --lines 20
[TAILING] Tailing last 20 lines for [apo360] process (change the value with --lines option)
/var/www/apo360.net/logs/error-0.log last 20 lines:
0|apo360   |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
0|apo360   |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49)
0|apo360   | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|apo360   | Error: DATABASE_URL debe estar configurada. Â¿Olvidaste crear la base de datos?
0|apo360   |     at server/db.ts (file:///var/www/apo360.net/dist/index.js:1187:13)
0|apo360   |     at __init (file:///var/www/apo360.net/dist/index.js:10:56)
0|apo360   |     at server/storage.ts (file:///var/www/apo360.net/dist/index.js:1225:5)
0|apo360   |     at __init (file:///var/www/apo360.net/dist/index.js:10:56)
0|apo360   |     at file:///var/www/apo360.net/dist/index.js:3932:1
0|apo360   |     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|apo360   |     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24)
0|apo360   | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|apo360   | Error: DATABASE_URL debe estar configurada. Â¿Olvidaste crear la base de datos?
0|apo360   |     at server/db.ts (file:///var/www/apo360.net/dist/index.js:1187:13)
0|apo360   |     at __init (file:///var/www/apo360.net/dist/index.js:10:56)
0|apo360   |     at server/storage.ts (file:///var/www/apo360.net/dist/index.js:1225:5)
0|apo360   |     at __init (file:///var/www/apo360.net/dist/index.js:10:56)
0|apo360   |     at file:///var/www/apo360.net/dist/index.js:3932:1
0|apo360   |     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|apo360   |     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24)

/var/www/apo360.net/logs/output-0.log last 20 lines:
0|apo360   | 2025-12-10T03:13:36: 3:13:36 AM [express] GET /api/servicios 500 in 139ms :: {"message":"Error al obtener servicios"}
0|apo360   | 2025-12-10T03:13:41: 3:13:41 AM [express] GET /api/configuracion/franja_emergencia 500 in 13ms :: {"message":"Error al obâ€¦
0|apo360   | 2025-12-10T03:13:41: 3:13:41 AM [express] GET /api/configuracion/roles 500 in 18ms :: {"message":"Error al obtener configâ€¦
0|apo360   | 2025-12-10T03:13:43: 3:13:43 AM [express] POST /api/auth/login 500 in 12ms :: {"message":"Hostname/IP does not match certâ€¦
0|apo360   | 2025-12-10T03:13:46: 3:13:46 AM [express] POST /api/auth/login 500 in 10ms :: {"message":"Hostname/IP does not match certâ€¦
0|apo360   | 2025-12-10T03:13:47: 3:13:47 AM [express] GET /api/login 302 in 3ms
0|apo360   | 2025-12-10T03:13:48: 3:13:48 AM [express] GET /api/callback 500 in 454ms :: {"message":"Hostname/IP does not match certifâ€¦
0|apo360   | 2025-12-10T03:16:27: ğŸ” Modo de autenticaciÃ³n solicitado: google
0|apo360   | 2025-12-10T03:16:27: âœ… Google OAuth configurado correctamente
0|apo360   | 2025-12-10T03:16:27: ğŸš€ Servidor WebSocket configurado en /ws
0|apo360   | 2025-12-10T03:16:27: 3:16:27 AM [express] ğŸ”„ Verificando migraciÃ³n de miembros_grupo...
0|apo360   | 2025-12-10T03:16:27: 3:16:27 AM [express] âš ï¸ Error en migraciÃ³n automÃ¡tica (se ignorarÃ¡): [object Object]
0|apo360   | 2025-12-10T03:16:27: 3:16:27 AM [express] serving on port 5000
0|apo360   | 2025-12-10T03:28:17: ğŸ—„ï¸ Usando PostgreSQL local (producciÃ³n)
0|apo360   | 2025-12-10T03:28:17: ğŸ” Modo de autenticaciÃ³n solicitado: google
0|apo360   | 2025-12-10T03:28:17: âœ… Google OAuth configurado correctamente
0|apo360   | 2025-12-10T03:28:17: ğŸš€ Servidor WebSocket configurado en /ws
0|apo360   | 2025-12-10T03:28:17: 3:28:17 AM [express] ğŸ”„ Verificando migraciÃ³n de miembros_grupo...
0|apo360   | 2025-12-10T03:28:18: 3:28:18 AM [express] âœ… Tabla miembros_grupo ya estÃ¡ sincronizada
0|apo360   | 2025-12-10T03:28:18: 3:28:18 AM [express] serving on port 5000

