root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net# pm2 status
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ apo360             â”‚ fork     â”‚ 3    â”‚ online    â”‚ 0%       â”‚ 50.7mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@srv1170282:/var/www/apo360.net# pm2 logs apo360 --lines 50
[TAILING] Tailing last 50 lines for [apo360] process (change the value with --lines option)
/root/.pm2/logs/apo360-out.log last 50 lines:
0|apo360   | âœ… Usuario encontrado: aapomayta15@gmail.com, Rol: super_admin
0|apo360   | âœ… Login exitoso: aapomayta15@gmail.com
0|apo360   | ğŸ” Real DB Login attempt: aapomayta15@gmail.com
0|apo360   | âœ… Usuario encontrado: aapomayta15@gmail.com, Rol: super_admin
0|apo360   | âœ… Login exitoso: aapomayta15@gmail.com
0|apo360   | ğŸ” Real DB Login attempt: aapomayta15@gmail.com
0|apo360   | âœ… Usuario encontrado: aapomayta15@gmail.com, Rol: super_admin
0|apo360   | âœ… Login exitoso: aapomayta15@gmail.com
0|apo360   | ==============================================
0|apo360   | ğŸš€ APO360 JWT STANDARD SERVER
0|apo360   | ğŸ“ Puerto: 5000
0|apo360   | ğŸ” AutenticaciÃ³n: JWT estÃ¡ndar
0|apo360   | ğŸ”‘ Credenciales: aapomayta15@gmail.com / Admin123!
0|apo360   | ğŸŒ Frontend: http://localhost:5000/
0|apo360   | ==============================================
0|apo360   | ğŸ” Login attempt: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso: aapomayta15@gmail.com
0|apo360   | ğŸ” Login attempt: aapomayta15@gmail.com
0|apo360   | âŒ ContraseÃ±a incorrecta para: aapomayta15@gmail.com
0|apo360   | ğŸ” Login attempt: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso: aapomayta15@gmail.com
0|apo360   | ğŸ” Login attempt: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso: aapomayta15@gmail.com
0|apo360   | ==============================================
0|apo360   | ğŸš€ APO360 COMPATIBILITY SERVER
0|apo360   | ğŸ“ Puerto: 5000
0|apo360   | ğŸ” AutenticaciÃ³n: ACEPTA CUALQUIER TOKEN
0|apo360   | ğŸ¯ Objetivo: Hacer que el frontend funcione
0|apo360   | ğŸ”‘ Credenciales: aapomayta15@gmail.com / Admin123!
0|apo360   | ğŸŒ Frontend: http://localhost:5000/
0|apo360   | ==============================================
0|apo360   |
0|apo360   | ğŸ’¡ INSTRUCCIONES PARA PROBAR:
0|apo360   | 1. Login devuelve 4 tipos de token
0|apo360   | 2. /api/auth/user acepta CUALQUIER token que empiece con "Bearer"
0|apo360   | 3. /api/users/me funciona incluso SIN token
0|apo360   | ğŸ” Login: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso. Tokens generados: jwt, simple, random, legacy
0|apo360   | âœ… Token aceptado: eyJhbGciOiJIUzI1NiIs...
0|apo360   | âš ï¸  Sin token, usando usuario por defecto
0|apo360   | âœ… Token aceptado: token-inventado-1234...
0|apo360   | ğŸ” Login: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso. Tokens generados: jwt, simple, random, legacy
0|apo360   | ğŸ” Login: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso. Tokens generados: jwt, simple, random, legacy
0|apo360   | âœ… Token aceptado: eyJhbGciOiJIUzI1NiIs...
0|apo360   | ğŸ” Login: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso. Tokens generados: jwt, simple, random, legacy
0|apo360   | ğŸ” Login: aapomayta15@gmail.com
0|apo360   | âœ… Login exitoso. Tokens generados: jwt, simple, random, legacy

/root/.pm2/logs/apo360-error.log last 50 lines:
0|apo360   |   dataType: undefined,
0|apo360   |   constraint: undefined,
0|apo360   |   file: 'parse_relation.c',
0|apo360   |   line: '1449',
0|apo360   |   routine: 'parserOpenTable'
0|apo360   | }
0|apo360   | Error en login: error: relation "users" does not exist
0|apo360   |     at file:///var/www/apo360.net/node_modules/@neondatabase/serverless/index.mjs:1345:74
0|apo360   |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|apo360   |     at async NeonPreparedQuery.execute (file:///var/www/apo360.net/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
0|apo360   |     at async DatabaseStorage.getUserByEmail (file:///var/www/apo360.net/dist/index.js:1216:27)
0|apo360   |     at async file:///var/www/apo360.net/dist/index.js:5628:20 {
0|apo360   |   length: 106,
0|apo360   |   severity: 'ERROR',
0|apo360   |   code: '42P01',
0|apo360   |   detail: undefined,
0|apo360   |   hint: undefined,
0|apo360   |   position: '1555',
0|apo360   |   internalPosition: undefined,
0|apo360   |   internalQuery: undefined,
0|apo360   |   where: undefined,
0|apo360   |   schema: undefined,
0|apo360   |   table: undefined,
0|apo360   |   column: undefined,
0|apo360   |   dataType: undefined,
0|apo360   |   constraint: undefined,
0|apo360   |   file: 'parse_relation.c',
0|apo360   |   line: '1449',
0|apo360   |   routine: 'parserOpenTable'
0|apo360   | }
0|apo360   | ReferenceError: require is not defined in ES module scope, you can use import instead
0|apo360   | This file is being treated as an ES module because it has a '.js' file extension and '/var/www/apo360.net/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
0|apo360   |     at file:///var/www/apo360.net/server.js:1:12
0|apo360   |     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|apo360   |     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24)
0|apo360   | ReferenceError: require is not defined in ES module scope, you can use import instead
0|apo360   | This file is being treated as an ES module because it has a '.js' file extension and '/var/www/apo360.net/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
0|apo360   |     at file:///var/www/apo360.net/server.js:1:12
0|apo360   |     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|apo360   |     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24)
0|apo360   | ReferenceError: require is not defined in ES module scope, you can use import instead
0|apo360   | This file is being treated as an ES module because it has a '.js' file extension and '/var/www/apo360.net/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
0|apo360   |     at file:///var/www/apo360.net/server.js:1:12
0|apo360   |     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|apo360   |     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24)
0|apo360   | ReferenceError: require is not defined in ES module scope, you can use import instead
0|apo360   | This file is being treated as an ES module because it has a '.js' file extension and '/var/www/apo360.net/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
0|apo360   |     at file:///var/www/apo360.net/server.js:1:12
0|apo360   |     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|apo360   |     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24)



^C
root@srv1170282:/var/www/apo360.net# cat /var/www/apo360.net/.env | head -20
SESSION_SECRET=Q1WbrRv7MMG7ElYk08ePw7QuIhCkp3hzMEqQJ5tUn2ZNtzOBGgRCOizEpXoYl/1r/Bt7eCWtKMVEseEvVu1kJQ==
DATABASE_URL=postgresql://neondb_owner:npg_W0PnqUe6vTSG@ep-wandering-mode-afa3c7cd.c-2.us-west-2.aws.neon.tech/neondb?sslmode=require
PGDATABASE=neondb
PGHOST=ep-wandering-mode-afa3c7cd.c-2.us-west-2.aws.neon.tech
PGPORT=5432
PGUSER=neondb_owner
PGPASSWORD=npg_W0PnqUe6vTSG
SMTP_HOST=smtp.gmail.com
SMTP_USER=aapomayta15@gmail.com
SMTP_PASSWORD=frog svje eiih jfga
SMTP_PORT=587
GOOGLE_CLIENT_ID=16943049442-mbv8ll4g7iu186nttlahsdhh8of1jq1u.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
clientId=16943049442-mbv8ll4g7iu186nttlahsdhh8of1jq1u.apps.googleusercontent.com
REPL_ID=16943049442-mbv8ll4g7iu186nttlahsdhh8of1jq1u.apps.googleusercontent.com
root@srv1170282:/var/www/apo360.net# curl http://localhost:5000/api/auth/user
curl: (7) Failed to connect to localhost port 5000 after 0 ms: Couldn't connect to server
root@srv1170282:/var/www/apo360.net#