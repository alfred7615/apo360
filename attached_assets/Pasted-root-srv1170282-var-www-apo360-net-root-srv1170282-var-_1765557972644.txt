root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net# git config pull.rebase false
root@srv1170282:/var/www/apo360.net# git pull origin main
From https://github.com/alfred7615/apo360
 * branch            main       -> FETCH_HEAD
Merge made by the 'ort' strategy.
 GUIA_MIGRACION_DICIEMBRE_2025.md                                            | 262 +++++++++++++
 PROCESO_SINCRONIZACION_BD.md                                                |  66 ++++
 ...ed--3-TIPO-DE-ROLES-3-ROL-CATEGORIA-SUBC-1765524109067_1765524109068.txt | 245 ++++++++++++
 ...ed--3-TIPO-DE-ROLES-3-ROL-CATEGORIA-SUBC-1765524672725_1765524672727.txt | 245 ++++++++++++
 ...ed--3-TIPO-DE-ROLES-3-ROL-CATEGORIA-SUBC-1765524716719_1765524716722.txt | 245 ++++++++++++
 ...IPO-DE-ROLES-3-ROL-CATEGORIA-SUBCATEGORIA-DESCRIPCION-_1765555605576.txt | 244 ++++++++++++
 ...oot-srv1170282-var-www-apo360-net-root-srv1170282-var-_1765486955262.txt | 758 ++++++++++++++++++++++++++++++++++++
 ...oot-srv1170282-var-www-apo360-net-root-srv1170282-var-_1765487028920.txt |  78 ++++
 client/src/components/CalculadoraCambio.tsx                                 | 127 +++---
 client/src/components/CambistaPanelUsuario.tsx                              | 506 ++++++++++++++++++++++++
 client/src/components/admin/categorias-rol-section.tsx                      | 242 +++++++++++-
 client/src/pages/admin/gestiones/gestion-categorias-rol.tsx                 | 314 ++++++++++++++-
 client/src/pages/admin/gestiones/gestion-moneda.tsx                         | 259 ++++++++----
 client/src/pages/admin/gestiones/gestion-usuarios.tsx                       |  49 ++-
 client/src/pages/panel-usuario.tsx                                          | 431 +++++++++++++++++++-
 .../assets/comprobantes/firma-alfredo-apomayta-1765554917593-12284475.png   | Bin 0 -> 41913 bytes
 .../assets/comprobantes/firma-alfredo-apomayta-1765554967429-898775937.png  | Bin 0 -> 41913 bytes
 .../assets/comprobantes/firma-alfredo-apomayta-1765556634402-371825771.png  | Bin 0 -> 41913 bytes
 replit.md                                                                   |   4 +-
 scripts/actualizar-estructura.sql                                           |  97 +++++
 scripts/sistema-roles.sql                                                   | 355 +++++++++++++++++
 server/routes-admin.ts                                                      |  11 +-
 server/routes.ts                                                            | 523 +++++++++++++++++++++++--
 server/storage.ts                                                           | 328 ++++++++++++++--
 shared/schema.ts                                                            | 168 +++++---
 25 files changed, 5243 insertions(+), 314 deletions(-)
 create mode 100644 GUIA_MIGRACION_DICIEMBRE_2025.md
 create mode 100644 attached_assets/Pasted--3-TIPO-DE-ROLES-3-ROL-CATEGORIA-SUBC-1765524109067_1765524109068.txt
 create mode 100644 attached_assets/Pasted--3-TIPO-DE-ROLES-3-ROL-CATEGORIA-SUBC-1765524672725_1765524672727.txt
 create mode 100644 attached_assets/Pasted--3-TIPO-DE-ROLES-3-ROL-CATEGORIA-SUBC-1765524716719_1765524716722.txt
 create mode 100644 attached_assets/Pasted-TIPO-DE-ROLES-3-ROL-CATEGORIA-SUBCATEGORIA-DESCRIPCION-_1765555605576.txt
 create mode 100644 attached_assets/Pasted-root-srv1170282-var-www-apo360-net-root-srv1170282-var-_1765486955262.txt
 create mode 100644 attached_assets/Pasted-root-srv1170282-var-www-apo360-net-root-srv1170282-var-_1765487028920.txt
 create mode 100644 client/src/components/CambistaPanelUsuario.tsx
 create mode 100644 public/assets/comprobantes/firma-alfredo-apomayta-1765554917593-12284475.png
 create mode 100644 public/assets/comprobantes/firma-alfredo-apomayta-1765554967429-898775937.png
 create mode 100644 public/assets/comprobantes/firma-alfredo-apomayta-1765556634402-371825771.png
 create mode 100644 scripts/sistema-roles.sql
root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net#
root@srv1170282:/var/www/apo360.net# npm run build

> rest-express@1.0.0 build
> vite build && esbuild server/index-prod.ts --platform=node --packages=external --bundle --format=esm --outfile=dist/index.js

vite v5.4.20 building for production...
transforming (4) src/App.tsx
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
âœ“ 2793 modules transformed.
../dist/public/index.html                     1.53 kB â”‚ gzip:   0.67 kB
../dist/public/assets/index-B-QnSnX9.css    148.80 kB â”‚ gzip:  27.49 kB
../dist/public/assets/index-D9ZcfqEq.js   1,534.31 kB â”‚ gzip: 381.62 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 15.50s
â–² [WARNING] Duplicate member "updateServicio" in class body [duplicate-class-member]

    server/storage.ts:1893:8:
      1893 â”‚   async updateServicio(id: string, data: any): Promise<any> {
           â•µ         ~~~~~~~~~~~~~~

  The original member "updateServicio" is here:

    server/storage.ts:835:8:
      835 â”‚   async updateServicio(id: string, data: Partial<InsertServicio>): Promise<Servicio | undefined> {
          â•µ         ~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getFavoritosUsuario" in class body [duplicate-class-member]

    server/storage.ts:2458:8:
      2458 â”‚   async getFavoritosUsuario(usuarioId: string, tipo?: string): Promise<any[]> {
           â•µ         ~~~~~~~~~~~~~~~~~~~

  The original member "getFavoritosUsuario" is here:

    server/storage.ts:803:8:
      803 â”‚   async getFavoritosUsuario(usuarioId: string): Promise<any[]> {
          â•µ         ~~~~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getInteraccionesUsuario" in class body [duplicate-class-member]

    server/storage.ts:2702:8:
      2702 â”‚   async getInteraccionesUsuario(
           â•µ         ~~~~~~~~~~~~~~~~~~~~~~~

  The original member "getInteraccionesUsuario" is here:

    server/storage.ts:579:8:
      579 â”‚   async getInteraccionesUsuario(publicidadId: string, usuarioId: string): Promise<{ hasLike: boolean; has...
          â•µ         ~~~~~~~~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "getComentarios" in class body [duplicate-class-member]

    server/storage.ts:2726:8:
      2726 â”‚   async getComentarios(tipoContenido: string, contenidoId: string): Promise<Comentario[]> {
           â•µ         ~~~~~~~~~~~~~~

  The original member "getComentarios" is here:

    server/storage.ts:1862:8:
      1862 â”‚   async getComentarios(tipoContenido: string, contenidoId: string): Promise<Comentario[]> {
           â•µ         ~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "createComentario" in class body [duplicate-class-member]

    server/storage.ts:2742:8:
      2742 â”‚   async createComentario(data: InsertComentario): Promise<Comentario> {
           â•µ         ~~~~~~~~~~~~~~~~

  The original member "createComentario" is here:

    server/storage.ts:1875:8:
      1875 â”‚   async createComentario(data: InsertComentario): Promise<Comentario> {
           â•µ         ~~~~~~~~~~~~~~~~

â–² [WARNING] Duplicate member "deleteComentario" in class body [duplicate-class-member]

    server/storage.ts:2756:8:
      2756 â”‚   async deleteComentario(id: string): Promise<void> {
           â•µ         ~~~~~~~~~~~~~~~~

  The original member "deleteComentario" is here:

    server/storage.ts:1883:8:
      1883 â”‚   async deleteComentario(id: string): Promise<void> {
           â•µ         ~~~~~~~~~~~~~~~~

6 of 9 warnings shown (disable the message limit with --log-limit=0)

  dist/index.js  435.5kb

âš¡ Done in 51ms
root@srv1170282:/var/www/apo360.net# psql "postgresql://apo360_admin:Admin2025@127.0.0.1:5432/apo360_prod?sslmode=disable" -f scripts/sistema-roles.sql
CREATE TABLE
CREATE TABLE
DO
CREATE TABLE
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
INSERT 0 3
INSERT 0 9
INSERT 0 3
INSERT 0 8
INSERT 0 2
INSERT 0 6
INSERT 0 2
INSERT 0 4
INSERT 0 3
INSERT 0 4
INSERT 0 3
INSERT 0 3
INSERT 0 2
INSERT 0 3
INSERT 0 4
INSERT 0 5
INSERT 0 4
INSERT 0 4
INSERT 0 3
INSERT 0 3
psql:scripts/sistema-roles.sql:321: NOTICE:  Roles de prueba asignados correctamente
DO
psql:scripts/sistema-roles.sql:347: NOTICE:  Solicitudes de prueba creadas correctamente
DO
           mensaje            | total
------------------------------+-------
 CategorÃ­as de roles creadas: |    29
(1 row)

             mensaje             | total
---------------------------------+-------
 SubcategorÃ­as de roles creadas: |    49
(1 row)

           mensaje           | total
-----------------------------+-------
 Roles de usuario asignados: |     3
(1 row)

        mensaje        | total
-----------------------+-------
 Solicitudes de roles: |     2
(1 row)

root@srv1170282:/var/www/apo360.net# pm2 restart apo360
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [apo360](ids: [ 0 ])
[PM2] [apo360](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ apo360             â”‚ cluster  â”‚ 17   â”‚ online    â”‚ 0%       â”‚ 40.0mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@srv1170282:/var/www/apo360.net# pm2 logs apo360 --lines 20
[TAILING] Tailing last 20 lines for [apo360] process (change the value with --lines option)
/var/www/apo360.net/logs/error-0.log last 20 lines:
0|apo360   |     at async DatabaseStorage.getSubcategoriasRol (file:///var/www/apo360.net/dist/index.js:3260:16)
0|apo360   |     at async file:///var/www/apo360.net/dist/index.js:5996:29 {
0|apo360   |   length: 117,
0|apo360   |   severity: 'ERROR',
0|apo360   |   code: '42P01',
0|apo360   |   detail: undefined,
0|apo360   |   hint: undefined,
0|apo360   |   position: '124',
0|apo360   |   internalPosition: undefined,
0|apo360   |   internalQuery: undefined,
0|apo360   |   where: undefined,
0|apo360   |   schema: undefined,
0|apo360   |   table: undefined,
0|apo360   |   column: undefined,
0|apo360   |   dataType: undefined,
0|apo360   |   constraint: undefined,
0|apo360   |   file: 'parse_relation.c',
0|apo360   |   line: '1449',
0|apo360   |   routine: 'parserOpenTable'
0|apo360   | }

/var/www/apo360.net/logs/output-0.log last 20 lines:
0|apo360   | 2025-12-12T16:45:04: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:45:14: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:45:21: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:45:30: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:45:36: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:45:45: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:45:55: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:46:03: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:46:13: âŒ WebSocket rechazado: Usuario no autenticado
0|apo360   | 2025-12-12T16:46:20: ğŸ—„ï¸ Usando PostgreSQL local (producciÃ³n)
0|apo360   | 2025-12-12T16:46:20: ğŸ” Modo de autenticaciÃ³n solicitado: basic
0|apo360   | 2025-12-12T16:46:20: ğŸ” Configurando autenticaciÃ³n bÃ¡sica (email/contraseÃ±a)...
0|apo360   | 2025-12-12T16:46:20: âœ… AutenticaciÃ³n bÃ¡sica configurada
0|apo360   | 2025-12-12T16:46:20:    ğŸ“§ Login: POST /api/auth/login
0|apo360   | 2025-12-12T16:46:20:    ğŸ“ Registro: POST /api/auth/register
0|apo360   | 2025-12-12T16:46:20: ğŸš€ Servidor WebSocket configurado en /ws
0|apo360   | 2025-12-12T16:46:20: 4:46:20 PM [express] ğŸ”„ Verificando migraciÃ³n de miembros_grupo...
0|apo360   | 2025-12-12T16:46:20: 4:46:20 PM [express] âœ… Tabla miembros_grupo ya estÃ¡ sincronizada
0|apo360   | 2025-12-12T16:46:20: 4:46:20 PM [express] serving on port 5000
0|apo360   | 2025-12-12T16:46:23: âŒ WebSocket rechazado: Usuario no autenticado

0|apo360  | 2025-12-12T16:46:32: âŒ WebSocket rechazado: Usuario no autenticado

